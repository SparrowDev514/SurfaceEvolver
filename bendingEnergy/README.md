# 4.曲げ弾性エネルギーの計算
Surface Evolverで曲げ弾性エネルギーを定義したベシクルモデルは、BCモデルに従った再安定形状をとる。 
BCモデルのエネルギープロファイルを得るには、SEを使って様々なv, daのベシクルに対して再安定形状を計算する必要がある。この計算を以下のように自動化することを考える。  
1. 球状ベシクルから、任意のvの終点まで逐次的に形状を安定化させ、様々なvを持つベシクルの初期形状を得る。
1. 各ベシクル初期形状から、任意のdaの終点まで逐次的に形状を安定化させる（daを増やす方向、減らす方向の両方向について行う）。
1. 各ステップで、安定化した際の曲げ弾性エネルギーをファイルに出力する。  

## 4.1 球状ベシクルからvを変化させる
以下の手順で行うと良いだろう。
1. 正方形モデルから`g`と`r`のコマンドを使って球状のSEモデルを作成し、dmpファイルを直接編集しENERGYのQUANTITYとしてsq_mean_curvatureメソッドを用いて曲げ弾性エネルギーを定義する。`r`コマンドの回数は計算時間に大きな影響を与えるため、この段階ではあまり多様しないこと（最終的に正確な曲げ弾性エネルギーを計算したいときにrefinementを増やす）。
1. vを徐々に小さくしながら形状を安定化させ、安定形状を逐次的に保存するコマンドを定義する。  
procedure.cmdのcrvを参照

Tips: vは0.1刻みで変化させると良いだろう（あるいは必要に応じてより細かく）。
※ あるいは、daをフリーにして計算することで、prolateのブランチに沿って計算するのも良いかもしれない

## 4.2 各ベシクル初期形状から、daを増減させる。
1. 前節で得た様々なvを持つベシクル形状から、注目したいvをもつベシクル初期形状を選ぶ。
1. 選んだベシクル初期形状から、daを増やし（あるいは減らし）ながら逐次的に安定形状を計算し、形状と曲げ弾性エネルギーを保存するコマンドを定義する。  
procedure.cmdのcdaを参照
1. cdaを増やす方向で変化させる場合と減らす方向で変化させる場合で、どちらか片方ではローカルミニマムに陥ってしまうことがある。従って、daを増やしながら計算した場合は、もう一度同じ計算を終点から出発して減らす方向で行い、計算を往復させ、往路と復路で値を比較する。
1. 得られたエネルギープロファイルをプロットすると、2つの極小値をもつことが分かる。これがoblateとprolateのブランチであり、この位置は正確に計算する必要がある。おおまかなプロファイルの計算はdaの刻みを0．1程度で行っても良いが、oblateとprolateのブランチ付近では、daの刻みを0.01以下にし、その部分だけ再計算する必要がある。
1. ここまでの作業で得られたエネルギープロファイルが、なめらかに変化しているか、値の飛びがないかチェックする。異常値を見つけたら、その部分の形状の安定化をやり直す。あまりに異常値が多い場合は、形状の安定化を自動化するコマンドの定義を見直すことを考える（jigglingやgの回数が足りないのかもしれない。あるいはspikeができているのかもしれない）。どうしても異常値が残る場合、少数であれば単に取り除いても良いだろう。
