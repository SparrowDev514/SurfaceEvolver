# 課題の手引き
## 安定化コマンドを使用するときのコツ
- `es`,`u`.`j`の順番に気を使う

`es`はspikeが発生しづらいようにvertexの接続数を最適化するコマンドであったが、`u`はedgeの長さを最小化するように接続数を最適化するコマンドであるから、両者の順序には気を使う必要がある。例えば接続数が4のvertexに対して
```
{
  g;
  V;
  es 2;
  u;
  j 0.01
}
```
と実行してしまうと、お互いの操作が打ち消し合ってしまい、結局接続数は4のままになってしまう。`es`による最適化をなるべく維持するためには直後に`V`組み込むと良い。

また`j`はvertexを再配置するコマンドであるから、`g`で最適化したあとに組み込むべきではない。   
以上より、安定化コマンドの適切な順序は以下のようにすべきであろう。
```
{
  j 0.01;
  g;
  u;
  es 2;
  V;
}
```

- jiggle`j`は二段階に分けて実行する  

コマンド`j`は、後ろに書く値(例えば`j 0.01`など)に応じて、vertexをランダムに配置し直す。vertexの配置は安定化コマンドを実行したときに、どんな形状に落ち着くかに関わる。すなわちその配置によっては特定のvertexだけ飛び出したり、不規則な形状を取りうる。これをエネルギーが準安定状態に陥っていると考えれば、vertexの再配置と安定化を繰り返すことでエネルギーが最も安定な状態に変化できるのではないか。   
一方でjiggleは再安定状態から準安定状態へ変化させる可能性も含むので、常にjiggleをかけ続けるのは好ましくない。故に最終的にはjiggleをかけないコマンドで安定化を目指すべきであろう。よってjiggleを用いる安定化の方法として、   
 (ⅰ)一定の`j`と安定化コマンドを繰り返すもの      
 (ⅱ)安定化コマンドの回数によって`j`の値が減衰していくもの   
の2つを用意するとよいだろう。
  
## v=0.76でのエネルギープロファイル作成
v0.76_dela1.03.dmpは`r`が2回の形状である。これを元にdaを変化させエネルギープロファイルを作成していく。   

- はじめの形状をきれいにしておく   
最初の形状を整えておかないと、うまく変形しにくい。上のデータではdiscocyteに似た安定形状をとっているが、自分で作る際はデータのようにvertexやメッシュの分布を均一にすることにも気をつけるべきだろう。またlimitting shape付近(da=0.5または1.4)から変化させるよりもsphereやdiscocyte付近(da= 1.00~1.03)から始めたほうがきれいな変形がみられる。   

- daを1.40まで変化させるとき   
まず`r`は2回のままで変形させ、得られたデータに対して、1つずつ`r`を加えて安定化の精度を上げていく。はじめから`r`3回でdaを変化させない理由として、da=1.00~1.40の間には準安定形状が多く存在しており、`r`2回ではみられない(メッシュが粗すぎてとれない)形状だが、`r`3回ではそれらの形を形成してしまい、変形を妨げてしまうからである。   

daを変化させるとき、変化量は0.001にしたほうが良い。0.01刻みで変化させると、prolateになるエネルギー(極値)付近でspikeが発生しやすい傾向がある。   
da変化後におこなうエネルギーの最小化については、以下のように自動化すると良い。`load`ではなく`replace_load`を使わないと、ファイル読込後にループから抜けてしまう。

```
procedure mbxb (real v0,real da) {
    for (del := 0 ; del <= 0.40 ; da += 0.001)
    {
      fname := sprintf "v%3.2f_dela%4.3f.dmp", v0, da;
      replace_load fname;
      r;
      {g 10;V 5;u} 200;
      
      f1name := sprintf "min_v%3.2f_dela%4.3f.dmp", v0, da;
      f1pname := sprintf "min_v%3.2f_dela%4.3f.eps", v0, da;
      dump f1name;
      postscript f1pname;
      printf "%g %g\n",da,bene.value >> "min_bene.txt";
      }
      
}
```
コマンドとして使用するときは、v0に固定している体積(0.76)、daに最初のda(1.034)を入力して使用する。for文の条件として
```
del := 0 ; del <= 0.40 
```
はif文中で使用されていないが、この条件式を省くとなぜか繰り返しが機能しなくなるため、上のコマンドでは残している。一応、daを増やしていくと、1.40以上のデータを読み込もうとしたときにエラーを起こしてループを脱出してくれる。すなわち、実際にはdaを変化させながら繰り返していることに気をつける。


  
