# 5. BCモデルのエネルギープロファイルの計算
前章で説明したエネルギー計算とファイルへの出力を用いて、BCモデルにおける曲げ弾性エネルギーのプロファイルを作成する。エネルギープロファイルは、様々なvに対して、daが0.5~1.4の範囲で計算し、プロットする。私が以前計算した結果を参考に載せる。

![bene_various_v.png](https://github.com/TakJim/SurfaceEvolver/blob/master/BCenergy/bene_various_v.png "図5-1")

このグラフについていくつか説明する。  
まず、エネルギーは球状ベシクルの曲げ弾性エネルギー8πκによって規格化してある。よってこのグラフ上で、球状ベシクルは(da=1,bene=1）の点上にある。 また、曲げ弾性エネルギーが2となるのは、球状ベシクル2つが小さいネックでつながった形状であるLimiting shapeである。また、それぞれの曲線には2つの極小点が存在していることが分かるだろう。極小点のうちdaが小さい方がoblateのブランチ、大きいほうがprolateのブランチである。
また、vが0．9以上のベシクルでは、daが1から大きく離れた領域をSE上で表現するのが難しかったため、曲げ弾性エネルギーの計算は途中で途切れている。これは、vが大きい領域ではベシクルの形状変化が細かいため、このエネルギープロファイル計算で使ったベシクルのrefine回数（=verticesの数）が足りなかったためだと考えられる。よりrefineの回数を増やせば、より細かいベシクル形状を再現できるが、計算量はrefineの回数に対して指数関数的に増大する。もし興味があればぜひvの大きい領域でdaの範囲を広げることにチャレンジして欲しい。  
他にも、このグラフには計算が上手く行われていない部分がいくつかある。例えば、いくつかの部分で、曲線がなめらかでなくガタついている。これらの点はADEモデルの相図を作る上で障害となる可能性があるため、計算し直すか、異常点を取り除いた方が良い。他にも、v=0.78の曲線ではprolateブランチの場所が適切に計算できていない。本来であればda=1.11~1.14付近を0.01以下の刻み幅で計算し、prolateブランチの場所を正確に計算する必要がある。  

以上の点を踏まえながら、各自BCモデルのエネルギープロファイルの計算に挑戦して欲しい。私はv=0.98からv=0.04刻みでプロファイルを計算したので、その中間であるv=0.96,0.92,0.88...を計算すると良いだろう。私の計算したのと同じ領域をより高精度で計算するのも良い。

## BCモデルのエネルギープロファイル作成の手順

前章で説明したように、BCモデルのエネルギープロファイルは以下のような手順で計算が可能である。

1. 球状ベシクルから、任意のvの終点まで逐次的に形状を安定化させ、様々なvを持つベシクルの初期形状を得る。
1. 各ベシクル初期形状から、任意のdaの終点まで逐次的に形状を安定化させる（daを増やす方向、減らす方向の両方向について行う）。
1. 各ステップで、安定化した際の曲げ弾性エネルギーをファイルに出力する。  
1. より正確なエネルギープロファイルを計算したい場合。作成された一連の形状に対して、refineを増やして形状の安定化を行い、結果を新たに出力する。

ここでは、前節で説明しなかった、4番目の手順について説明する。

## より正確なエネルギープロファイルを計算するためのテクニック

refineの回数は、ベシクル形状の細かさ、より正確な弾性エネルギーを計算するために増やしたほうが良い一方、形状の安定化に要する時間を膨大なものにしてしまう。計算時間をなるべく少なくするためには、まずrefine回数の少ない粗い形状で形状を安定化させることで、大まかな形状を合わせた後に、refine回数を増やし再度形状を安定化させていくと良い。  
この計算のために必要となるのは、逐次的に形状ファイルをロードし、refineと形状の安定化を行った後、次のファイルをロードし同じことを繰り返すというコマンドである。  
私は、この計算をJosef Stefan Instituteの計算機を借りて行っていたので、これから説明するものとは異なる方法で計算を行っていたため、予期せぬエラーが発生する可能性があるが、了承願いたい。  

### loadコマンドによる形状のロード
`load filename`というコマンドをevolverで実行することにより、現在開いている形状ファイルから別の形状ファイルをロードすることができる。このコマンドを形状の安定化が終了した後に実行し、全体を繰り返すようなコマンドを定義すればよい。

## 課題
前章と本章で説明した手順をによって、実際にBCモデルのエネルギープロファイルを作成してみる。  
1. まず、球状ベシクルからvを変化させながら形状を逐次的に安定化しながら形状をdumpし、様々なvを持つ初期形状ベシクルを用意する。  
1. 次に、計算したいvを持つ形状ファイルを開き、そこからda~0.5, 1.4に向かって逐次的にdaを減少、あるいは増加させながら形状を安定化し、安定化した形状データと曲げ弾性エネルギーを出力していく。
1. より正確なエネルギープロファイルを計算したい場合は、作成された一連の形状に対して、refinの回数を増やして形状の安定化を行い、結果を新たに出力する。
1. 最後に以下の点についてチェックする。
出力した曲げ弾性エネルギーをプロットして以下の点をチェックする。
    - エネルギープロファイルに飛びがなく、なめらかに遷移しているか。もしそうでなかったら、その点をピックアップして形状の安定化をやり直すか、全体のプロファイルの形に影響がなさそうであれば異常点として取り除く
    - oblateとprolateの極小点が正確に計算できているか。もしそうでなかったら、daの刻み幅を細かくして極小値周りの計算をやり直す。特に、daを増やすか減らすかの形状変化の方向によっては、どちらかがローカルミニマムに落ち込んでしまう可能性があるため、往復させながら計算することが重要である。


